---
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/Navbar";
import Gallery from "../../components/Gallery";
import Footer from "../../components/Footer";
import Hero from "../../components/Hero.astro";
import Events from "../../components/Events.astro";
import { getImage } from "astro:assets";
import { getCollection } from "astro:content";
import { useTranslations } from "../../i18n/utils";

export function getStaticPaths() {
  return [
    { params: { lang: "en" } },
    { params: { lang: "ca" } },
    { params: { lang: "it" } },
  ];
}

const { lang } = Astro.params;
const t = useTranslations(lang as any);

// Fetch gallery collection
const galleryEntries = await getCollection("gallery");
const sortedGallery = galleryEntries.sort(
  (a, b) => a.data.order - b.data.order,
);

// Process images to get optimized URLs
const optimizedImages = await Promise.all(
  sortedGallery.map(async (entry) => {
    const optimized = await getImage({
      src: entry.data.image,
      width: 1200,
      quality: 90,
      format: "webp",
    });
    return optimized.src;
  }),
);
---

<Layout title="Lucia Puccio | FotografÃ­a" lang={lang as any}>
  <Navbar client:only="react" lang={lang as any} />

  <main class="min-h-screen bg-transparent">
    <Hero lang={lang as any} />

    <!-- Gallery Section -->
    <section
      id="gallery"
      class="pt-24 md:pt-[45rem] pb-24 md:pb-[30rem] bg-transparent"
    >
      <div class="text-center mb-24" id="gallery-title-container">
        <h2
          class="text-5xl md:text-7xl font-serif italic text-coastal-stone-deep tracking-tighter mb-6"
        >
          {t("gallery.title")}
        </h2>
        <p
          class="text-[10px] uppercase tracking-[0.6em] text-stone-400 font-sans"
        >
          {t("gallery.subtitle")}
        </p>
      </div>
      <Gallery client:only="react" images={optimizedImages} />
      {
        optimizedImages.length === 0 && (
          <p class="text-center text-stone-500">{t("gallery.empty")}</p>
        )
      }
    </section>

    <Events lang={lang as any} />
  </main>

  <Footer client:visible lang={lang as any} />
</Layout>
